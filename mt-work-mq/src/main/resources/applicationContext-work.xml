<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xmlns:rabbit="http://www.springframework.org/schema/rabbit"
       xsi:schemaLocation="http://www.springframework.org/schema/rabbit
           http://www.springframework.org/schema/rabbit/spring-rabbit.xsd
http://www.springframework.org/schema/beans
http://www.springframework.org/schema/beans/spring-beans-4.0.xsd
http://www.springframework.org/schema/context
http://www.springframework.org/schema/context/spring-context-4.0.xsd
http://www.springframework.org/schema/tx
http://www.springframework.org/schema/tx/spring-tx-4.0.xsd">

    <context:component-scan base-package="com.loycl.mt.work"/>
    <tx:annotation-driven/>

	<!-- Activates scanning of @Autowired -->
	<context:annotation-config/>

	<!-- auto proxy -->
	<bean class="org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator"/>

		<rabbit:connection-factory
				id="amqpConnectionFactory"
				host="#{ systemEnvironment['MT_RABBIT_MQ_HOST']}"
				port="#{ systemEnvironment['MT_RABBIT_MQ_PORT']}"
				username="#{ systemEnvironment['MT_RABBIT_MQ_UNAME']}"
				password="#{ systemEnvironment['MT_RABBIT_MQ_PASSCODE']}"
				virtual-host="#{ systemEnvironment['MT_RABBIT_MQ_VHOST']}"
				channel-cache-size="#{ systemEnvironment['MT_RABBIT_MQ_CACHE_SIZE']}"/>



	<rabbit:topic-exchange name="mt.topic.exchange.sms">
    <rabbit:bindings>
        <rabbit:binding queue="sms.q.1" pattern="mt.route.*"/>
    </rabbit:bindings>
</rabbit:topic-exchange>

	<rabbit:template id="amqpTemplate"
	                 connection-factory="amqpConnectionFactory"
	                 exchange="mt.topic.exchange.sms"
	                 routing-key="mt.route.sms"/>

	<rabbit:admin connection-factory="amqpConnectionFactory"/>

	<rabbit:listener-container connection-factory="amqpConnectionFactory">
		<!-- adding more than one queue names will cause duplicate.-->
    <rabbit:listener ref="mtWorkerImpl" queue-names= "sms.q.1"/>
 </rabbit:listener-container>

</beans>